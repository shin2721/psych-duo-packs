name: Lesson Authoring Single Source Check

on:
  pull_request:
    branches: [ main, master ]
    paths:
      - 'docs/**'
      - 'scripts/**'
      - '.agent/**'
      - '**/*.md'
  push:
    branches: [ main, master ]
    paths:
      - 'docs/**'
      - 'scripts/**'
      - '.agent/**'
      - '**/*.md'

jobs:
  check-single-source:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Check Lesson Authoring Single Source
      run: npm run lint:lesson-authoring
      
    - name: Report success
      if: success()
      run: |
        echo "âœ… ãƒ¬ãƒƒã‚¹ãƒ³ä½œæˆä»•æ§˜ã®æ­£æœ¬ä¸€æœ¬åŒ–ãŒç¶­æŒã•ã‚Œã¦ã„ã¾ã™"
        echo "ğŸ“‹ docs/PRINCIPLES.md ãŒå”¯ä¸€ã®æ­£æœ¬ã¨ã—ã¦æ©Ÿèƒ½ã—ã¦ã„ã¾ã™"
        
    - name: Report failure
      if: failure()
      run: |
        echo "âŒ ãƒ¬ãƒƒã‚¹ãƒ³ä½œæˆä»•æ§˜ã®åˆ†è£‚ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
        echo "ğŸ’¡ ä¿®æ­£æ–¹æ³•: é•åãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ«ãƒ¼ãƒ«æœ¬æ–‡ã‚’å‰Šé™¤ã—ã€docs/PRINCIPLES.md ã¸ã®å‚ç…§ãƒªãƒ³ã‚¯ã«ç½®æ›ã—ã¦ãã ã•ã„"
        exit 1