# データ拡充戦略の比較と推奨方式

## 背景

現在のPSYCH_TERMSは47項目しかなく、26の内容型のうち13タイプ（50%）がこのデータを共有しているため、15問中6問（40%）が重複する問題が発生しています。

## 目標

- **現状**: 47項目（therapies: 15, disorders: 14, concepts: 18）
- **目標**: 90項目（therapies: 20, disorders: 30, concepts: 40）
- **期待効果**: 重複率 40% → 5%、継続率 3レッスン → 10レッスン（3.3倍）

## 3つのアプローチ

### 方式A: 完全手動作成

#### プロセス
1. 心理学の専門知識を持つ人が用語を選定
2. 日本語名、英語名、説明文を手動で作成
3. エビデンス確認（論文検索）

#### メリット
- ✅ 最高品質（人間の専門知識）
- ✅ 完全なコントロール
- ✅ エビデンスの確実性

#### デメリット
- ❌ 非常に時間がかかる（1項目5分 × 90項目 = 7.5時間）
- ❌ スケールしない
- ❌ 専門知識が必要
- ❌ 疲れる（退屈な作業）

#### コスト
- **時間**: 7.5時間
- **金銭**: 無料

#### 推奨度
⭐⭐☆☆☆ - 小規模プロジェクトや特殊な用語の場合のみ

---

### 方式B: Claude完全自動生成

#### プロセス
1. Claudeに「therapies 5個、disorders 16個、concepts 22個を生成して」と依頼
2. JSON形式で一括生成
3. ユーザーがレビュー・修正

#### メリット
- ✅ 非常に速い（10分程度）
- ✅ 簡単（プロンプト1回で完了）
- ✅ 説明文も自動生成

#### デメリット
- ⚠️ エビデンス不明（Claudeの知識のみ）
- ⚠️ 論文との整合性不明
- ⚠️ 幻覚（hallucination）のリスク
- ⚠️ 既存データとの重複チェックが必要

#### コスト
- **時間**: 10分
- **金銭**: 約$0.02（Claude API使用）

#### 推奨度
⭐⭐⭐☆☆ - 素早いプロトタイピングや初期データ生成に有効

#### 実装
`scripts/expand_psych_terms_with_claude.mjs`

#### 出力例
```json
{
  "therapies": [
    { "ja": "ゲシュタルト療法", "en": "Gestalt Therapy", "desc": "今の気づきに焦点" }
  ],
  "disorders": [
    { "ja": "スマホ依存", "en": "Smartphone Addiction", "symptom": "スマホが手放せない" }
  ]
}
```

**実績**: すでに43項目を生成済み（`data/psych_terms_candidates.json`）

---

### 方式C: DeepL統合ハイブリッド方式【推奨】

#### プロセス
1. **論文からキーワード抽出**（正規表現）
   - 824本の論文から英語キーワードを自動抽出
   - エビデンスベース（論文に登場 = 科学的根拠あり）

2. **DeepL APIで翻訳**
   - 英語キーワード → 日本語名（高品質翻訳）
   - 機械的で一貫性のある翻訳

3. **Claude説明文生成**
   - 各用語に15文字以内の説明文を生成
   - 日本語名 + 英語名を渡すことで精度向上

4. **ユーザーレビュー**
   - 生成されたデータを確認・修正
   - 重複チェック

#### メリット
- ✅ 論文ベース（エビデンスあり）
- ✅ 翻訳は機械的（品質安定）
- ✅ スケーラブル（論文が増えれば自動拡充）
- ✅ トレーサビリティ（どの論文から来たか追跡可能）
- ✅ 低コスト

#### デメリット
- ⚠️ 最終レビューは必要
- ⚠️ 論文にない概念は抽出できない
- ⚠️ 英語キーワードの抽出パターン調整が必要

#### コスト
- **時間**: 15分（抽出1分 + 翻訳5分 + 生成5分 + レビュー4分）
- **金銭**: 約$0.03（DeepL無料枠内 + Claude API）

#### 推奨度
⭐⭐⭐⭐⭐ - **最もバランスが取れた方式**

#### 実装
`scripts/expand_with_deepl.mjs`

#### ワークフロー図
```
論文 (824本)
    ↓
① キーワード抽出 (正規表現)
    ↓
英語キーワード
  - cognitive behavioral therapy
  - generalized anxiety disorder
  - emotion regulation
    ↓
② DeepL API翻訳
    ↓
日本語キーワード
  - 認知行動療法
  - 全般性不安症
  - 感情調整
    ↓
③ Claude説明文生成 (15文字)
    ↓
完成データ
  { ja: "認知行動療法", en: "CBT", desc: "考え方と行動を変える" }
    ↓
④ ユーザーレビュー
    ↓
⑤ PSYCH_TERMSにマージ
```

---

## 比較表

| 項目 | 方式A: 完全手動 | 方式B: Claude自動 | 方式C: DeepL統合【推奨】 |
|------|---------------|------------------|---------------------|
| **所要時間** | 7.5時間 | 10分 | 15分 |
| **金銭コスト** | 無料 | $0.02 | $0.03 |
| **エビデンス** | ✅ 確実 | ⚠️ 不明 | ✅ 論文ベース |
| **品質** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐☆☆ | ⭐⭐⭐⭐☆ |
| **スケーラビリティ** | ❌ 低い | ✅ 高い | ✅ 高い |
| **トレーサビリティ** | ✅ 完全 | ❌ なし | ✅ 論文ID記録 |
| **レビュー必要度** | 低 | 高 | 中 |
| **幻覚リスク** | なし | 高 | 低 |

## 推奨戦略

### Phase 1: PSYCH_TERMS拡充（完了済み）

**使用方式**: 方式B（Claude自動）

**理由**: 初期プロトタイプとして43項目を高速生成

**成果**: `data/psych_terms_candidates.json`（43項目）

**次のステップ**: ユーザーレビュー → マージ

---

### Phase 2: 論文ベース検証と追加【推奨】

**使用方式**: 方式C（DeepL統合）

**目的**:
1. Phase 1の43項目を論文で検証
2. 追加で論文ベースの項目を生成
3. 合計90項目達成

**手順**:
```bash
# 1. deepl-nodeをインストール
npm install deepl-node

# 2. DeepL API キーを取得（無料）
# https://www.deepl.com/pro-api

# 3. 環境変数設定
export DEEPL_API_KEY="your-key-here"
export ANTHROPIC_API_KEY="your-key-here"

# 4. 実行
node scripts/expand_with_deepl.mjs

# 5. 出力確認
cat data/psych_terms_from_papers.json

# 6. マージと重複削除
# - psych_terms_candidates.json（Claude生成）
# - psych_terms_from_papers.json（論文ベース）
# → 論文ベースを優先、重複削除

# 7. scripts/auto_generate_problems.mjs に統合
```

---

### Phase 3: REAL_LIFE_SITUATIONS拡充【今後】

**現状**: 60項目（10項目/unit × 6 units）

**目標**: 180項目（30項目/unit × 6 units）

**問題**: 論文からシナリオは抽出できない

**推奨方式**: 方式B（Claude自動）+ 手動レビュー

**理由**:
- 論文には実生活シナリオが書かれていない
- Claude生成 → ユーザーが現実的かチェック
- 単位ごとに30シナリオ必要（合計180）

---

## まとめ

### 現在の状況

| データベース | 現状 | 目標 | 推奨方式 | ステータス |
|------------|------|------|---------|----------|
| PSYCH_TERMS | 47項目 | 90項目 | 方式C（DeepL） | 🟡 Phase 1完了 |
| REAL_LIFE_SITUATIONS | 60項目 | 180項目 | 方式B（Claude） | ⬜ 未着手 |

### 次のアクション

1. ✅ **完了**: 方式B（Claude）で43項目生成
2. 🟡 **進行中**: 方式C（DeepL）で論文ベース検証
3. ⬜ **未着手**: REAL_LIFE_SITUATIONS拡充

### 推奨実装順序

1. **今すぐ**: DeepL統合スクリプトを実行（15分）
2. **レビュー**: 両方のデータを比較・マージ（30分）
3. **統合**: `auto_generate_problems.mjs` に追加（10分）
4. **テスト**: 問題生成して重複率を確認（5分）
5. **Phase 3開始**: REAL_LIFE_SITUATIONS拡充へ

---

## 参考資料

- [DeepL統合ワークフロー詳細](./DEEPL_WORKFLOW.md)
- [自動問題生成README](../scripts/README_AUTO_GENERATE.md)
- [DeepL API Documentation](https://developers.deepl.com/docs)
